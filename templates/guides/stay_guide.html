{% extends "base.html" %}

{% block title %}入住指南 - 云栖CloudEase{% endblock %}

{% block extra_css %}
<style>
    .guide-section {
        margin-bottom: 3rem;
    }
    .guide-card {
        border-radius: 12px;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
        height: 100%;
        border: none;
    }
    .guide-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(26, 115, 232, 0.1);
    }
    .guide-icon {
        width: 60px;
        height: 60px;
        background-color: var(--light-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        color: var(--primary-color);
        font-size: 1.5rem;
    }
    .section-title {
        position: relative;
        padding-bottom: 15px;
        margin-bottom: 30px;
        color: var(--primary-color);
    }
    .section-title:after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 50px;
        height: 3px;
        background-color: var(--primary-color);
    }
    .facility-item {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }
    .facility-icon {
        width: 40px;
        height: 40px;
        background-color: var(--light-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        color: var(--primary-color);
    }
    .timeline {
        position: relative;
        padding-left: 2rem;
    }
    .timeline:before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 2px;
        background-color: var(--primary-color);
    }
    .timeline-item {
        position: relative;
        padding-bottom: 2rem;
    }
    .timeline-item:last-child {
        padding-bottom: 0;
    }
    .timeline-item:before {
        content: '';
        position: absolute;
        left: -2rem;
        top: 0.5rem;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background-color: var(--primary-color);
    }
    .emergency-card {
        background-color: #ffebee;
        border-left: 4px solid #f44336;
    }
    .tip-card {
        background-color: #e8f0fe;
        border-left: 4px solid var(--primary-color);
    }
    .map-container {
        height: 400px;
        border-radius: 8px;
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="section-title">入住指南</h1>
            <p class="lead text-muted">欢迎入住「{{ property.title }}」，这份指南将帮助您顺利入住并了解周边生活设施</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="{{ url_for('property.view_property', property_id=property.id) }}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>返回民宿详情
            </a>
        </div>
    </div>

    <!-- 入住流程 -->
    <div class="guide-section">
        <h2 class="section-title">入住流程</h2>
        <div class="timeline">
            <div class="timeline-item">
                <h4>预订确认</h4>
                <p>完成预订后，您将收到确认邮件，其中包含入住详情和房东联系方式。</p>
            </div>
            <div class="timeline-item">
                <h4>到达前沟通</h4>
                <p>入住前一天，房东将与您联系确认到达时间，并提供详细的入住指引。</p>
            </div>
            <div class="timeline-item">
                <h4>自助入住</h4>
                <p>使用智能门锁密码（将在入住当天通过短信发送给您）即可进入房间。</p>
            </div>
            <div class="timeline-item">
                <h4>入住体验</h4>
                <p>入住期间如有任何问题，可随时通过云栖App或电话联系房东。</p>
            </div>
            <div class="timeline-item">
                <h4>退房</h4>
                <p>退房时间为中午12:00前，只需关好门窗，无需其他手续。</p>
            </div>
        </div>
    </div>

    <!-- 房屋设施使用指南 -->
    <div class="guide-section">
        <h2 class="section-title">房屋设施使用指南</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card guide-card shadow-sm">
                    <div class="card-body text-center">
                        <div class="guide-icon mx-auto">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <h4>WiFi</h4>
                        <p>网络名称：CloudEase-{{ property.id }}<br>密码：将在入住当天通过短信发送</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card guide-card shadow-sm">
                    <div class="card-body text-center">
                        <div class="guide-icon mx-auto">
                            <i class="fas fa-temperature-high"></i>
                        </div>
                        <h4>空调</h4>
                        <p>遥控器位于客厅电视柜上<br>建议温度设置：夏季26℃，冬季20℃</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card guide-card shadow-sm">
                    <div class="card-body text-center">
                        <div class="guide-icon mx-auto">
                            <i class="fas fa-shower"></i>
                        </div>
                        <h4>热水器</h4>
                        <p>开关位于卫生间门口<br>预热时间约10分钟</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card guide-card shadow-sm">
                    <div class="card-body text-center">
                        <div class="guide-icon mx-auto">
                            <i class="fas fa-tv"></i>
                        </div>
                        <h4>智能电视</h4>
                        <p>支持各大视频平台<br>已预装Netflix、爱奇艺等应用</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card guide-card shadow-sm">
                    <div class="card-body text-center">
                        <div class="guide-icon mx-auto">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <h4>厨房设备</h4>
                        <p>配备基础烹饪工具<br>调料位于橱柜右侧</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card guide-card shadow-sm">
                    <div class="card-body text-center">
                        <div class="guide-icon mx-auto">
                            <i class="fas fa-trash"></i>
                        </div>
                        <h4>垃圾处理</h4>
                        <p>请将垃圾分类投放<br>垃圾桶位于厨房和卫生间</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 周边生活设施 -->
    <div class="guide-section">
        <h2 class="section-title">周边生活设施</h2>
        <div class="row">
            <div class="col-md-6">
                <div class="facility-item">
                    <div class="facility-icon">
                        <i class="fas fa-shopping-basket"></i>
                    </div>
                    <div>
                        <h5>超市/便利店</h5>
                        <p>全家便利店（步行3分钟）<br>永辉超市（步行10分钟）</p>
                    </div>
                </div>
                <div class="facility-item">
                    <div class="facility-icon">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div>
                        <h5>餐厅/美食</h5>
                        <p>云栖咖啡（步行5分钟）<br>海底捞火锅（步行15分钟）<br>星巴克（步行8分钟）</p>
                    </div>
                </div>
                <div class="facility-item">
                    <div class="facility-icon">
                        <i class="fas fa-hospital"></i>
                    </div>
                    <div>
                        <h5>医疗服务</h5>
                        <p>社区诊所（步行5分钟）<br>市第一人民医院（车程10分钟）</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="facility-item">
                    <div class="facility-icon">
                        <i class="fas fa-subway"></i>
                    </div>
                    <div>
                        <h5>交通</h5>
                        <p>地铁2号线云栖站（步行8分钟）<br>公交站（步行3分钟）</p>
                    </div>
                </div>
                <div class="facility-item">
                    <div class="facility-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div>
                        <h5>银行/ATM</h5>
                        <p>中国银行（步行7分钟）<br>建设银行ATM（步行5分钟）</p>
                    </div>
                </div>
                <div class="facility-item">
                    <div class="facility-icon">
                        <i class="fas fa-dumbbell"></i>
                    </div>
                    <div>
                        <h5>休闲娱乐</h5>
                        <p>社区公园（步行3分钟）<br>健身房（步行10分钟）</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- 添加交互式地图 -->
        <div class="mt-4">
            <h4 class="mb-3">周边设施地图</h4>
            <div class="card shadow-sm">
                <div class="card-body">
                    <div id="facilities-map" class="map-container"></div>
                    <div class="mt-3 text-center">
                        <button class="btn btn-sm btn-outline-primary me-2" onclick="showOnMap('restaurants')">餐厅</button>
                        <button class="btn btn-sm btn-outline-primary me-2" onclick="showOnMap('shopping')">购物</button>
                        <button class="btn btn-sm btn-outline-primary me-2" onclick="showOnMap('transport')">交通</button>
                        <button class="btn btn-sm btn-outline-primary me-2" onclick="showOnMap('medical')">医疗</button>
                        <button class="btn btn-sm btn-outline-primary" onclick="showOnMap('entertainment')">娱乐</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 注意事项 -->
    <div class="guide-section">
        <h2 class="section-title">注意事项</h2>
        <div class="row g-4">
            <div class="col-md-6">
                <div class="card emergency-card p-4">
                    <h4><i class="fas fa-exclamation-triangle me-2"></i>紧急联系</h4>
                    <ul class="list-unstyled">
                        <li class="mb-2"><strong>紧急求助：</strong>110</li>
                        <li class="mb-2"><strong>火警：</strong>119</li>
                        <li class="mb-2"><strong>急救：</strong>120</li>
                        <li class="mb-2"><strong>房东电话：</strong>{{ property.owner.phone }}</li>
                        <li><strong>物业电话：</strong>0755-12345678</li>
                    </ul>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card tip-card p-4">
                    <h4><i class="fas fa-lightbulb me-2"></i>温馨提示</h4>
                    <ul>
                        <li class="mb-2">请爱护房屋内设施，损坏需照价赔偿</li>
                        <li class="mb-2">请勿在室内吸烟</li>
                        <li class="mb-2">请保持安静，尊重邻居</li>
                        <li class="mb-2">外出时请锁好门窗，关闭电源</li>
                        <li>如有特殊需求，请提前与房东沟通</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key|default('', true) }}&callback=initMap" defer></script>
<script>
    // 初始化地图
    function initMap() {
        // 民宿位置坐标（示例坐标）
        const propertyLocation = { lat: 22.5431, lng: 114.0579 };
        
        // 创建地图
        const map = new google.maps.Map(document.getElementById("facilities-map"), {
            zoom: 15,
            center: propertyLocation,
        });
        
        // 添加民宿标记
        const propertyMarker = new google.maps.Marker({
            position: propertyLocation,
            map: map,
            title: "{{ property.title }}",
            icon: {
                url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
            }
        });
        
        // 周边设施数据
        const facilities = {
            restaurants: [
                { name: "云栖咖啡", lat: 22.5445, lng: 114.0590, type: "restaurants" },
                { name: "海底捞火锅", lat: 22.5460, lng: 114.0600, type: "restaurants" },
                { name: "星巴克", lat: 22.5450, lng: 114.0570, type: "restaurants" }
            ],
            shopping: [
                { name: "全家便利店", lat: 22.5435, lng: 114.0585, type: "shopping" },
                { name: "永辉超市", lat: 22.5455, lng: 114.0595, type: "shopping" }
            ],
            transport: [
                { name: "地铁2号线云栖站", lat: 22.5440, lng: 114.0610, type: "transport" },
                { name: "公交站", lat: 22.5425, lng: 114.0580, type: "transport" }
            ],
            medical: [
                { name: "社区诊所", lat: 22.5435, lng: 114.0575, type: "medical" },
                { name: "市第一人民医院", lat: 22.5470, lng: 114.0620, type: "medical" }
            ],
            entertainment: [
                { name: "社区公园", lat: 22.5420, lng: 114.0585, type: "entertainment" },
                { name: "健身房", lat: 22.5445, lng: 114.0605, type: "entertainment" }
            ]
        };
        
        // 存储所有标记
        const markers = [];
        
        // 显示特定类型的设施
        window.showOnMap = function(type) {
            // 清除现有标记
            markers.forEach(marker => marker.setMap(null));
            markers.length = 0;
            
            // 添加新标记
            if (facilities[type]) {
                facilities[type].forEach(facility => {
                    const marker = new google.maps.Marker({
                        position: { lat: facility.lat, lng: facility.lng },
                        map: map,
                        title: facility.name,
                        animation: google.maps.Animation.DROP
                    });
                    
                    // 添加信息窗口
                    const infoWindow = new google.maps.InfoWindow({
                        content: `<div><strong>${facility.name}</strong></div>`
                    });
                    
                    marker.addListener("click", () => {
                        infoWindow.open(map, marker);
                    });
                    
                    markers.push(marker);
                });
            }
        };
    }
</script>
{% endblock %}